@model Aircnc.FrontStage.Models.ViewModels.RoomOwner.CalendarViewModel
@{
    ViewData["Title"] = "編輯月曆";

    Layout = "RoomOwnerNavbar.cshtml";
    var jsonDrop = Html.Raw(ViewData["JsonUpDown"]);
}

@section topCSS{
    <style>
        td {
            border: 1px solid #EBEBEB;
            height: 80px;
        }

        #Change_area {
            min-height: 100vh;
        }

        .input_price {
            height: 3rem;
            border: 1px solid #B0B0B0;
            border-radius: 5px;
            padding-left: 2rem;
        }
    </style>
}


<body>
    <div class="contanire-fluid">
        <div class="row ps-5">
            <!-- 月曆區 -->
            <div class="col-9">

                <div class="w-100 d-flex">
                    <div class="my-5 fs-2 ms-2 me-auto" id="monthtext"></div>
                    <div class="dropdown ms-auto my-auto">
                        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1"
                                data-bs-toggle="dropdown" aria-expanded="false">
                            @if (Model.UserAllRooms.Count() > 0)
                            {
                                @*@Model.UserAllRooms[0].RoomName;*@
                                var p = "請選擇房源";
                                @p;

                            }
                            else {
                                var p = "尚未有房源";
                                @p;

                            }

                        </button>
                        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton1" id="RoomNameDropMenu">
                            @*<li><a class="dropdown-item" href="#">Action</a></li>
                            <li><a class="dropdown-item" href="#">Another action</a></li>
                            <li><a class="dropdown-item" href="#">Something else here</a></li>*@
                        </ul>
                    </div>
                </div>
                <table class="table  ">
                    <thead class="table">
                        <tr>
                            <th>日</th>
                            <th>一</th>
                            <th>二</th>
                            <th>三</th>
                            <th>四</th>
                            <th>五</th>
                            <th>六</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- 動態生成 -->
                    </tbody>
                </table>
                <div class="col-12 d-flex ">
                    <button class="btn btn-primary ms-auto" onclick="lastMonth()">上個月</button>
                    <button class="btn btn-primary ms-3" onclick="nextMonth()">下個月</button>
                </div>
            </div>

            <!-- 選項 -->
            @*<div class="col-3 border-start" id="Change_area">
                <div class="row mt-5  ">
                    <div class="col-12 fs-3 fw-bolder mt-5 ">{{4月9日 週六}}</div>
                    <div class="col-12 d-flex justify-content-between mt-5 pb-5 border-bottom">
                        <div class="fs-5 mt-auto mb-auto fw-bolder">可供預定</div>
                        <div>
                            <button class="btn fs-2"><i class="far fa-check-circle"></i></button>
                            <button class="btn fs-2"><i class="far fa-times-circle"></i></button>
                        </div>
                    </div>
                    <div class="col-12 border-bottom">
                        <div class="mt-3 fs-5 fw-bolder">每晚訂價</div>
                        <div id="input_ctrl " class="w-100 mt-3 mb-5">
                            <input type="text" value="500" class="w-75 input_price"
                                   onkeyup="value=value.replace(/^(0+)|[^\d]+/g,'')">
                        </div>
                    </div>
                </div>
            </div>*@


        </div>
    </div>


    @section endJS{ 
    <script>

        //抓今天日期
        const today = new Date()

        let year = today.getFullYear()
        //month0開始
        let month = today.getMonth()
        let date = today.getDate()


        //Dom
        const RoomNameDropMenu = document.getElementById('RoomNameDropMenu')

        const monthText = document.querySelector('#monthtext')

        const dateArea = document.querySelector('tbody')

        const addModal = document.querySelector('#add-modal')
        const editModal = document.querySelector('#edit-modal')
        const todoModal = document.querySelector('#todo-modal')

        const addDateInput = document.querySelector('#add-date')
        const addTitleInput = document.querySelector('#add-title')
        const editDateInput = document.querySelector('#edit-date')
        const editTitleInput = document.querySelector('#edit-title')

        const todoModalText = document.querySelector('.todo-modal-text')

        let count = document.querySelector('.count')

        window.onload = function () {
            init()
            console.log(dropSourse)
            initDropMenu()
        }
        function init() {
            //要傳進日曆使用的data
            ///room roomcalendar

            dateArea.innerHTML = ''
            monthText.innerText = `${year}年${month + 1}月`
            // monthText.innerText = months[month]
            // yearText.innerText = year

            //這個月第一天禮拜幾
            let firstDay = new Date(year, month, 1).getDay()
            //這個月有幾天
            let dayOfMonth = new Date(year, month + 1, 0).getDate()
            //上個月有幾天
            let previousOfMonth = new Date(year, month, 0).getDate()

            let nextMonthDay = 1

            let day = 1
            let rows = Math.ceil((dayOfMonth + firstDay) / 7)



            for (let row = 0; row < rows; row++) {
                let tr = document.createElement('tr')
                for (let col = 0; col < 7; col++) {
                    let td = document.createElement('td')
                    if (row == 0 && col < firstDay) {
                        //上個月
                        td.innerText = `${previousOfMonth - firstDay + 1}`
                        previousOfMonth++
                        td.classList.add('opacity-25')

                    } else {
                        if (day <= dayOfMonth) {
                            //這個月
                            td.innerText = day
                            //今天之前的日子
                            if (day < today.getDate() && month == today.getMonth() && year == today.getFullYear() ||
                                month < today.getMonth() && year <= today.getFullYear() || year < today.getFullYear()) {
                                td.classList.add('opacity-25')
                            }
                            //今天
                            if (day == today.getDate() && month == today.getMonth() && year == today.getFullYear()) {
                                let TodaySpan = document.createElement('span')
                                TodaySpan.innerText = '今天'
                                TodaySpan.classList.add('fw-bolder')
                                TodaySpan.classList.add('ms-2')
                                td.appendChild(TodaySpan)

                            }
                            //今天和之後 邏輯寫在這邊
                            if (day >= today.getDate() && month == today.getMonth() && year ==
                                today.getFullYear()) {
                                //生成右側選項
                                //將值接過去
                                //找出有沒有這天的資料from calendar
                                //沒有的話價格跟預定都帶預設值
                                //有的話要帶calendar表的值
                                //寫Crud功能



                            }




                        } else {
                            //下個月
                            td.innerText = nextMonthDay
                            nextMonthDay++
                            td.classList.add('opacity-25')
                        }
                        day++
                    }

                    tr.append(td)
                }
                dateArea.append(tr)
            }

        }

        function lastMonth() {
            month--
            if (month == -1) {
                month = 11
                year--
            }
            init()
            monthText.innerText = `${year}年${month + 1}月`
        }

        function nextMonth() {
            month++
            if (month == 12) {
                month = 0
                year++
            }
            init()
            monthText.innerText = `${year}年${month + 1}月`
        }

        let dropSourse = []
        dropSourse = @jsonDrop
        console.log(dropSourse)
        function initDropMenu() {
            RoomNameDropMenu.innerHTML = ''

            if (dropSourse.length == 0) {
                let li = document.createElement('li')
                let a = document.createElement('a')
                a.innerText = "創建房源"
                a.setAttribute('class', 'dropdown-item')
                a.setAttribute('href', `/RoomOwner/CreateRoom`)
                li.appendChild(a)
                RoomNameDropMenu.appendChild(li)
            }
            else {
                dropSourse.forEach(room => {
                    let li = document.createElement('li')
                    let a = document.createElement('a')
                    a.innerText = room.RoomName
                    a.setAttribute('class', 'dropdown-item')
                    a.setAttribute('href', `/RoomOwner/CalendarRoomId?roomid=${room.RoomId}`)
                    li.appendChild(a)
                    //要寫超連結src
                    RoomNameDropMenu.appendChild(li)

                })
            }


                //< li > <a class="dropdown-item" href="#">Action</a></li >
                //<li><a class="dropdown-item" href="#">Another action</a></li>
                //<li><a class="dropdown-item" href="#">Something else here</a></li>

        }
    </script>
    }
</body>
